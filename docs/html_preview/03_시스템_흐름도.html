<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>03_ì‹œìŠ¤í…œ_íë¦„ë„</title>

    <!-- Mermaid.js CDN -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                diagramMarginX: 50,
                diagramMarginY: 10,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                useMaxWidth: true
            }
        });
    </script>

    <style>
        @media print {
            @page {
                size: A4 portrait;
                margin: 2cm;
            }

            /* ë¸Œë¼ìš°ì € ê¸°ë³¸ í—¤ë”/í‘¸í„° ìˆ¨ê¸°ê¸° */
            @page {
                margin-top: 2cm;
                margin-bottom: 2cm;
            }

            body {
                margin: 0;
                padding: 0;
            }

            .print-button {
                display: none !important;
            }

            /* Mermaid ë‹¤ì´ì–´ê·¸ë¨ í˜ì´ì§€ ë¸Œë ˆì´í¬ ë°©ì§€ */
            .mermaid {
                page-break-inside: avoid;
                break-inside: avoid;
            }

            pre {
                page-break-inside: avoid;
            }
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Malgun Gothic", "ë§‘ì€ ê³ ë”•",
                         "Segoe UI", "Noto Sans KR", Arial, sans-serif;
            line-height: 1.7;
            color: #24292e;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #ffffff;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        h1 {
            color: #1a1a1a;
            border-bottom: 4px solid #0366d6;
            padding-bottom: 12px;
            margin-top: 32px;
            margin-bottom: 24px;
            font-size: 2.2em;
            font-weight: 700;
            page-break-after: avoid;
        }

        h2 {
            color: #24292e;
            border-bottom: 2px solid #e1e4e8;
            padding-bottom: 10px;
            margin-top: 28px;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 600;
            page-break-after: avoid;
        }

        h3 {
            color: #24292e;
            margin-top: 24px;
            margin-bottom: 16px;
            font-size: 1.4em;
            font-weight: 600;
            page-break-after: avoid;
        }

        h4 {
            color: #24292e;
            margin-top: 20px;
            margin-bottom: 12px;
            font-size: 1.15em;
            font-weight: 600;
            page-break-after: avoid;
        }

        /* Mermaid ë‹¤ì´ì–´ê·¸ë¨ ìŠ¤íƒ€ì¼ */
        .mermaid {
            background-color: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 24px;
            margin: 24px 0;
            overflow-x: auto;
            text-align: center;
            page-break-inside: avoid;
        }

        .mermaid svg {
            max-width: 100%;
            height: auto;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            display: table;
            overflow-x: auto;
            page-break-inside: avoid;
        }

        th, td {
            border: 1px solid #d0d7de;
            padding: 10px 16px;
            text-align: left;
        }

        th {
            background-color: #0366d6;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f6f8fa;
        }

        /* ì½”ë“œ ë¸”ë¡ ìŠ¤íƒ€ì¼ */
        code {
            background-color: #f6f8fa;
            padding: 3px 6px;
            border-radius: 4px;
            font-family: "Consolas", "Monaco", "Courier New", monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }

        pre {
            background-color: #f6f8fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #0366d6;
            overflow-x: auto;
            margin: 20px 0;
            page-break-inside: avoid;
        }

        pre code {
            background-color: transparent;
            padding: 0;
            color: #24292e;
            font-size: 0.9em;
        }

        /* ì¸ìš©êµ¬ ìŠ¤íƒ€ì¼ */
        blockquote {
            border-left: 4px solid #0366d6;
            padding: 12px 20px;
            margin: 20px 0;
            background-color: #f6f8fa;
            color: #57606a;
            border-radius: 4px;
        }

        blockquote p {
            margin: 0;
        }

        /* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        ul, ol {
            margin: 16px 0;
            padding-left: 32px;
        }

        li {
            margin: 8px 0;
        }

        /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 24px auto;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* ë§í¬ ìŠ¤íƒ€ì¼ */
        a {
            color: #0366d6;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* êµ¬ë¶„ì„  ìŠ¤íƒ€ì¼ */
        hr {
            border: none;
            border-top: 2px solid #e1e4e8;
            margin: 32px 0;
        }

        /* í”„ë¦°íŠ¸ ë²„íŠ¼ */
        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #0366d6 0%, #0256c7 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(3,102,214,0.3);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .print-button:hover {
            background: linear-gradient(135deg, #0256c7 0%, #024aa8 100%);
            box-shadow: 0 6px 16px rgba(3,102,214,0.4);
            transform: translateY(-2px);
        }

        .print-button:active {
            transform: translateY(0);
        }

        /* ì´ëª¨ì§€ ìŠ¤íƒ€ì¼ */
        .emoji {
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
        }

        /* ì£¼ì„ ìŠ¤íƒ€ì¼ (Note) */
        p strong {
            color: #0366d6;
        }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">
        <span class="emoji">ğŸ–¨ï¸</span> PDFë¡œ ì €ì¥
    </button>

    <h1>Fetpal ì‹œìŠ¤í…œ íë¦„ë„</h1>
<blockquote>
<p><strong>4ì°¨ ìŠ¤í”„ë¦°íŠ¸ ë°œí‘œ</strong> (2025.11.14)<br />
<strong>ìµœì¢… ë°œí‘œ</strong>: (2025-11-21)</p>
</blockquote>
<hr />
<h2>ğŸ“‹ ë¬¸ì„œ ê°œìš”</h2>
<p>ì´ ë¬¸ì„œëŠ” Fetpal í”„ë¡œì íŠ¸ì˜ ì£¼ìš” ê¸°ëŠ¥ë³„ ì‚¬ìš©ì í”Œë¡œìš°ì™€ ì‹œìŠ¤í…œ ê°„ ìƒí˜¸ì‘ìš©ì„ ë‹¤ì´ì–´ê·¸ë¨ê³¼ í•¨ê»˜ ì„¤ëª…í•©ë‹ˆë‹¤.</p>
<hr />
<h2>ğŸ¯ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê°œìš”</h2>
<div class="mermaid">
graph TB
    User[ì‚¬ìš©ì] --> Frontend[Next.js Frontend]
    Frontend --> Supabase[Supabase BaaS]
    Frontend --> FastAPI[FastAPI AI Server]
    Frontend --> KakaoAPI[Kakao Map API]

    Supabase --> PostgreSQL[(PostgreSQL + pgvector)]
    Supabase --> Auth[Supabase Auth]
    Supabase --> Storage[Supabase Storage]
    Supabase --> Realtime[Supabase Realtime]

    FastAPI --> YOLO[YOLO Models]
    YOLO --> HealthModel[Health Model]
    YOLO --> EyesModel[Eyes Model]
    YOLO --> SkinModel[Skin Model]

    PostgreSQL --> RAG[RAG System]
    RAG --> HuggingFace[HuggingFace Embedding]

</div>

<hr />
<h2>ğŸ” 1. íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ í”Œë¡œìš°</h2>
<h3>1.1. íšŒì›ê°€ì… í”„ë¡œì„¸ìŠ¤</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant SupaAuth as Supabase Auth
    participant DB as PostgreSQL
    participant Trigger as DB Trigger

    User->>Frontend: íšŒì›ê°€ì… í¼ ì œì¶œ (ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸)
    Frontend->>SupaAuth: signUp() í˜¸ì¶œ
    SupaAuth->>DB: auth.users í…Œì´ë¸”ì— ì‚¬ìš©ì ìƒì„±
    DB->>Trigger: handle_user_signup íŠ¸ë¦¬ê±° ì‹¤í–‰
    Trigger->>DB: profiles í…Œì´ë¸” ìë™ ìƒì„±
    Trigger->>DB: profileCompletion í…Œì´ë¸” ì´ˆê¸°í™”
    DB->>Frontend: íšŒì›ê°€ì… ì„±ê³µ ì‘ë‹µ
    Frontend->>User: ì´ë©”ì¼ ì¸ì¦ ì•ˆë‚´

</div>

<p><strong>ì£¼ìš” íŠ¹ì§•</strong>:</p>
<ul>
<li>íŠ¸ë¦¬ê±° ê¸°ë°˜ ìë™ í”„ë¡œí•„ ìƒì„±</li>
<li>ì´ë©”ì¼ ì¸ì¦ ì‹œìŠ¤í…œ</li>
<li>profileCompletionìœ¼ë¡œ ê°€ì… ì§„í–‰ë„ ì¶”ì </li>
</ul>
<h3>1.2. ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant SupaAuth as Supabase Auth
    participant DB as PostgreSQL

    User->>Frontend: ë¡œê·¸ì¸ í¼ ì œì¶œ
    Frontend->>SupaAuth: signInWithPassword()
    SupaAuth->>DB: ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
    DB->>SupaAuth: ì¸ì¦ ì„±ê³µ
    SupaAuth->>Frontend: JWT í† í° ë°˜í™˜
    Frontend->>Frontend: ì„¸ì…˜ ì €ì¥ (localStorage)
    Frontend->>User: ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

</div>

<hr />
<h2>ğŸ  2. ë©”ì¸ ëŒ€ì‹œë³´ë“œ í”Œë¡œìš°</h2>
<h3>2.1. ëŒ€ì‹œë³´ë“œ ì´ˆê¸° ë¡œë”©</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL

    User->>Frontend: /main/HomePage ì ‘ì†
    Frontend->>DB: profiles í…Œì´ë¸” ì¡°íšŒ (ì‚¬ìš©ì ì •ë³´)
    Frontend->>DB: palProfiles í…Œì´ë¸” ì¡°íšŒ (ë°˜ë ¤ë™ë¬¼ ëª©ë¡)
    Frontend->>DB: plannerEvents í…Œì´ë¸” ì¡°íšŒ (ì˜¤ëŠ˜ ì¼ì •)
    Frontend->>DB: palVaccinations í…Œì´ë¸” ì¡°íšŒ (ë°±ì‹  í˜„í™©)
    DB->>Frontend: ëª¨ë“  ë°ì´í„° ë°˜í™˜
    Frontend->>User: ëŒ€ì‹œë³´ë“œ ë Œë”ë§

    Note over Frontend: - WelcomeHeader (ì‚¬ìš©ì í”„ë¡œí•„)<br/>- PalStatisticsCards (í†µê³„)<br/>- TodayScheduleCard (ì˜¤ëŠ˜ ì¼ì •)<br/>- QuickActionsBar (ë¹ ë¥¸ ê¸°ëŠ¥)

</div>

<hr />
<h2>ğŸ©º 3. AI ì„ì‹œì§„ë‹¨ í”Œë¡œìš°</h2>
<h3>3.1. YOLO ì´ë¯¸ì§€ ë¶„ì„ í”„ë¡œì„¸ìŠ¤</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant FastAPI as FastAPI Server
    participant YOLO as YOLO Models
    participant LLM as LLM (GPT/Gemini/Claude)

    User->>Frontend: ì´ë¯¸ì§€ ì—…ë¡œë“œ (Drag & Drop)
    Frontend->>Frontend: ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
    User->>Frontend: "ë¶„ì„ ì‹œì‘" ë²„íŠ¼ í´ë¦­
    Frontend->>FastAPI: POST /api/detect (ì´ë¯¸ì§€ + ëª¨ë¸ ì„ íƒ)
    FastAPI->>YOLO: ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ë° ì¶”ë¡ 
    YOLO->>YOLO: ë°”ìš´ë”© ë°•ìŠ¤ + ì‹ ë¢°ë„ ê³„ì‚°
    YOLO->>FastAPI: íƒì§€ ê²°ê³¼ ë°˜í™˜
    FastAPI->>FastAPI: ê²°ê³¼ ì´ë¯¸ì§€ ìƒì„± (ë°”ìš´ë”© ë°•ìŠ¤ í‘œì‹œ)
    FastAPI->>Frontend: JSON ì‘ë‹µ (íƒì§€ ê²°ê³¼ + ì´ë¯¸ì§€ URL)
    Frontend->>User: íƒì§€ ê²°ê³¼ ì‹œê°í™”

    User->>Frontend: "AI ì¡°ì–¸ ë°›ê¸°" ë²„íŠ¼ í´ë¦­
    Frontend->>LLM: íƒì§€ ê²°ê³¼ + í”„ë¡¬í”„íŠ¸ ì „ì†¡
    LLM->>Frontend: ìƒí™© ëŒ€ì²˜ ë°©ì•ˆ + ë³‘ì› ì¶”ì²œ
    Frontend->>User: AI ì¡°ì–¸ í‘œì‹œ

</div>

<p><strong>ì§€ì› ëª¨ë¸</strong>:</p>
<ul>
<li><strong>Health ëª¨ë¸</strong>: ì „ì‹  ê±´ê°• ì²´í¬ (3ê°œ í´ë˜ìŠ¤)</li>
<li><strong>Eyes ëª¨ë¸</strong>: ì•ˆêµ¬ì§ˆí™˜ ê°ì§€ (30ê°œ í´ë˜ìŠ¤)</li>
<li><strong>Skin ëª¨ë¸</strong>: í”¼ë¶€ì§ˆí™˜ ê°ì§€ (6ê°œ í´ë˜ìŠ¤)</li>
</ul>
<h3>3.2. RAG ê¸°ë°˜ ì§€ì‹ ê²€ìƒ‰ í”Œë¡œìš° â­</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL (pgvector)
    participant HF as HuggingFace
    participant LLM as LLM

    User->>Frontend: "ë¹„ìŠ·í•œ ê²½í—˜ ì°¾ê¸°" í´ë¦­
    Frontend->>HF: ì§ˆë¬¸ í…ìŠ¤íŠ¸ ì„ë² ë”© ìƒì„± (384ì°¨ì›)
    HF->>Frontend: ì„ë² ë”© ë²¡í„° ë°˜í™˜
    Frontend->>DB: search_similar_knowledge(ë²¡í„°, ì„ê³„ê°’, ê°œìˆ˜)
    DB->>DB: ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚° (Vector Search)
    DB->>Frontend: ìœ ì‚¬í•œ ê²Œì‹œê¸€ Top 5 ë°˜í™˜
    Frontend->>User: ì»¤ë®¤ë‹ˆí‹° ê²½í—˜ë‹´ í‘œì‹œ

    opt AI ì¡°ì–¸ ìƒì„±
        Frontend->>LLM: ê²€ìƒ‰ ê²°ê³¼ + ì‚¬ìš©ì ì§ˆë¬¸ ì „ì†¡
        LLM->>LLM: RAG ë°©ì‹ìœ¼ë¡œ ë‹µë³€ ìƒì„±
        LLM->>Frontend: ì‹ ë¢°ë„ ë†’ì€ ë‹µë³€ ë°˜í™˜
        Frontend->>User: AI ì¡°ì–¸ í‘œì‹œ
    end

</div>

<p><strong>RAG ì‹œìŠ¤í…œ íŠ¹ì§•</strong>:</p>
<ul>
<li><strong>ìë™ ì„ë² ë”©</strong>: ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ì‘ì„± ì‹œ íŠ¸ë¦¬ê±° ê¸°ë°˜ ìë™ ìƒì„±</li>
<li><strong>í’ˆì§ˆ ê´€ë¦¬</strong>: quality_score (0.00-1.00) + is_verified í”Œë˜ê·¸</li>
<li><strong>ì¶œì²˜ ì¶”ì </strong>: source (community, faq, youtube, manual)</li>
</ul>
<hr />
<h2>ğŸ“… 4. ì»¤ìŠ¤í…€ í”Œë˜ë„ˆ í”Œë¡œìš°</h2>
<h3>4.1. ì¼ì • ìƒì„± í”„ë¡œì„¸ìŠ¤</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL
    participant Trigger as DB Trigger

    User->>Frontend: ë‹¬ë ¥ì—ì„œ ë‚ ì§œ í´ë¦­
    Frontend->>User: UnifiedEventModal í‘œì‹œ
    User->>Frontend: ì¼ì • ì •ë³´ ì…ë ¥ (ì œëª©, ì‹œê°„, ë©”ëª¨ ë“±)
    User->>Frontend: "ì €ì¥" ë²„íŠ¼ í´ë¦­
    Frontend->>DB: plannerEvents INSERT
    DB->>Trigger: handle_planner_updated_at íŠ¸ë¦¬ê±°
    Trigger->>DB: updatedAt ìë™ ê°±ì‹ 
    DB->>Frontend: ìƒì„± ì„±ê³µ ì‘ë‹µ
    Frontend->>Frontend: ë‹¬ë ¥ UI ìë™ ì—…ë°ì´íŠ¸
    Frontend->>User: ìƒˆ ì¼ì • í‘œì‹œ

</div>

<h3>4.2. ì—°ì† ì¼ì • ë“œë˜ê·¸ ìƒì„± (Range Event)</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant Hook as useRangeEventDrag
    participant DB as PostgreSQL

    User->>Frontend: ë‹¬ë ¥ì—ì„œ ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ ì‹œì‘
    Frontend->>Hook: handleMouseDown(ë‚ ì§œ1)
    User->>Frontend: ë§ˆìš°ìŠ¤ ì´ë™
    Hook->>Hook: ì„ íƒ ì˜ì—­ ì‹œê°í™” (í•˜ì´ë¼ì´íŠ¸)
    User->>Frontend: ë§ˆìš°ìŠ¤ ë¦´ë¦¬ì¦ˆ
    Hook->>Frontend: RangeEventModal í‘œì‹œ
    User->>Frontend: ì¼ì • ì •ë³´ ì…ë ¥
    User->>Frontend: "ì €ì¥" ë²„íŠ¼ í´ë¦­
    Frontend->>DB: ì—¬ëŸ¬ ë‚ ì§œì— ê±¸ì¹œ ì¼ì • ìƒì„± (consecutiveGroupId ë™ì¼)
    DB->>Frontend: ìƒì„± ì™„ë£Œ
    Frontend->>User: ì—°ì† ì¼ì • í‘œì‹œ

</div>

<h3>4.3. ë°±ì‹ -í”Œë˜ë„ˆ ì‹¤ì‹œê°„ ë™ê¸°í™” â­</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL
    participant Trigger as Sync Trigger

    Note over User,Trigger: ì‹œë‚˜ë¦¬ì˜¤ 1: ë°±ì‹  ì¼ì • ìƒì„±
    User->>Frontend: ë°˜ë ¤ë™ë¬¼ ë“±ë¡ ì™„ë£Œ
    Frontend->>DB: palProfiles INSERT (ìƒë…„ì›”ì¼ í¬í•¨)
    DB->>Trigger: generate_vaccination_schedule()
    Trigger->>DB: palVaccinations INSERT (6ì¢… ë°±ì‹ )
    Trigger->>DB: plannerEvents INSERT (ë°±ì‹  ì¼ì • ìë™ ìƒì„±)
    DB->>Frontend: ì™„ë£Œ ì‘ë‹µ
    Frontend->>User: ë°±ì‹  ì¼ì •ì´ í”Œë˜ë„ˆì— ìë™ ì¶”ê°€ë¨

    Note over User,Trigger: ì‹œë‚˜ë¦¬ì˜¤ 2: í”Œë˜ë„ˆì—ì„œ ë°±ì‹  ì™„ë£Œ ì²´í¬
    User->>Frontend: í”Œë˜ë„ˆì—ì„œ ë°±ì‹  ì¼ì • ì²´í¬
    Frontend->>DB: plannerEvents UPDATE (isCompleted = true)
    DB->>Trigger: sync_planner_to_vaccination()
    Trigger->>DB: palVaccinations UPDATE (isCompleted = true)
    DB->>Frontend: ì™„ë£Œ ì‘ë‹µ
    Frontend->>User: ë°±ì‹  ìƒíƒœ ìë™ ë™ê¸°í™”

</div>

<p><strong>ë™ê¸°í™” íŠ¹ì§•</strong>:</p>
<ul>
<li><strong>ì–‘ë°©í–¥ ì‹¤ì‹œê°„ ë™ê¸°í™”</strong>: í”Œë˜ë„ˆ â†” ë°±ì‹ </li>
<li><strong>ìë™ ì¼ì • ìƒì„±</strong>: ìƒë…„ì›”ì¼ ê¸°ë°˜ 6ì¢… ë°±ì‹  ì¼ì •</li>
<li><strong>ê¸´ê¸‰ë„ ê³„ì‚°</strong>: ì§€ì—°/ê¸´ê¸‰/ê³§ì˜ˆì •/ì •ìƒ (ìƒ‰ìƒ ë¶„ë¥˜)</li>
</ul>
<hr />
<h2>ğŸ’¬ 5. ì»¤ë®¤ë‹ˆí‹° í”Œë¡œìš°</h2>
<h3>5.1. ê²Œì‹œê¸€ ì‘ì„± ë° í•´ì‹œíƒœê·¸ ìë™ ì¶”ì¶œ</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL
    participant Trigger as Hashtag Trigger
    participant RAG as RAG System

    User->>Frontend: ê²Œì‹œê¸€ ì‘ì„± (ì œëª©, ë‚´ìš©, ì´ë¯¸ì§€, #í•´ì‹œíƒœê·¸)
    User->>Frontend: "ì‘ì„± ì™„ë£Œ" ë²„íŠ¼ í´ë¦­
    Frontend->>DB: communityPosts INSERT
    DB->>Trigger: extract_and_update_post_hashtags()
    Trigger->>Trigger: #{í…ìŠ¤íŠ¸} ì •ê·œì‹ ì¶”ì¶œ
    Trigger->>DB: globalHashtags UPSERT (usageCount++)
    Trigger->>DB: communityPostHashtags INSERT

    Note over DB,RAG: RAG ì‹œìŠ¤í…œ ìë™ ì„ë² ë”©
    DB->>RAG: auto_generate_embedding_on_post()
    RAG->>RAG: HuggingFaceë¡œ 384ì°¨ì› ë²¡í„° ìƒì„±
    RAG->>DB: pet_knowledge_base INSERT

    DB->>Frontend: ê²Œì‹œê¸€ ìƒì„± ì™„ë£Œ
    Frontend->>User: í”¼ë“œì— ìƒˆ ê²Œì‹œê¸€ í‘œì‹œ

</div>

<h3>5.2. ì‹¤ì‹œê°„ ëŒ“ê¸€ ì‹œìŠ¤í…œ (2025-11-07 ì™„ì„±) â­</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL
    participant Realtime as Supabase Realtime
    participant OtherUsers as ë‹¤ë¥¸ ì‚¬ìš©ìë“¤

    User->>Frontend: ê²Œì‹œê¸€ í´ë¦­
    Frontend->>DB: postcomments í…Œì´ë¸” ì¡°íšŒ
    DB->>Frontend: ê¸°ì¡´ ëŒ“ê¸€ ëª©ë¡ ë°˜í™˜
    Frontend->>Realtime: postcomments í…Œì´ë¸” êµ¬ë… ì‹œì‘
    Frontend->>User: FeedDetailModal í‘œì‹œ

    User->>Frontend: ëŒ“ê¸€ ì‘ì„± ë° "ë“±ë¡" í´ë¦­
    Frontend->>DB: postcomments INSERT
    DB->>Realtime: INSERT ì´ë²¤íŠ¸ ë°œí–‰
    Realtime->>Frontend: ì‹¤ì‹œê°„ ì•Œë¦¼ (ëª¨ë“  êµ¬ë…ì)
    Frontend->>Frontend: ëŒ“ê¸€ ëª©ë¡ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
    Frontend->>User: ìƒˆ ëŒ“ê¸€ ì¦‰ì‹œ í‘œì‹œ

    Realtime->>OtherUsers: ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œë„ ì‹¤ì‹œê°„ ì „ì†¡
    OtherUsers->>OtherUsers: ëŒ“ê¸€ ìë™ ì¶”ê°€

</div>

<p><strong>ì‹¤ì‹œê°„ ëŒ“ê¸€ íŠ¹ì§•</strong>:</p>
<ul>
<li><strong>ëª¨ë‹¬ ë‚´ ì¦‰ì‹œ ë°˜ì˜</strong>: ëŒ“ê¸€ ì‘ì„± í›„ ìƒˆë¡œê³ ì¹¨ ì—†ì´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸</li>
<li><strong>ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€ ë™ê¸°í™”</strong>: postcomments í…Œì´ë¸” ì‹¤ì‹œê°„ êµ¬ë…</li>
<li><strong>ì™„ì „í•œ ì–‘ë°©í–¥ ë™ê¸°í™”</strong>: ëª¨ë‹¬ â†” í”¼ë“œ ì¹´ë“œ ì‹¤ì‹œê°„ ë°ì´í„° ì¼ì¹˜</li>
</ul>
<h3>5.3. ì¢‹ì•„ìš” ìë™ ì¹´ìš´íŒ… ì‹œìŠ¤í…œ â­</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL
    participant Trigger as Like Trigger

    User->>Frontend: ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­
    Frontend->>DB: postlikes INSERT (userId, postId)
    DB->>Trigger: update_post_likes_count()
    Trigger->>DB: communityPosts.likesCount++
    DB->>Frontend: ì™„ë£Œ ì‘ë‹µ
    Frontend->>User: ì¢‹ì•„ìš” ìˆ˜ ì¦‰ì‹œ ì—…ë°ì´íŠ¸

    Note over User,Trigger: ì¢‹ì•„ìš” ì·¨ì†Œ
    User->>Frontend: ì¢‹ì•„ìš” ë²„íŠ¼ ì¬í´ë¦­
    Frontend->>DB: postlikes DELETE
    DB->>Trigger: update_post_likes_count()
    Trigger->>DB: communityPosts.likesCount--
    DB->>Frontend: ì™„ë£Œ ì‘ë‹µ
    Frontend->>User: ì¢‹ì•„ìš” ìˆ˜ ì¦‰ì‹œ ì—…ë°ì´íŠ¸

</div>

<hr />
<h2>ğŸŒŸ 6. ë¼ì´í”„ìŠ¤íƒ€ì¼ ì‹¤ì‹œê°„ ì±„íŒ… í”Œë¡œìš° â­â­â­</h2>
<h3>6.1. ì±„íŒ…ë°© ì…ì¥ ë° ì‹¤ì‹œê°„ êµ¬ë…</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL
    participant Realtime as Supabase Realtime

    User->>Frontend: í•´ì‹œíƒœê·¸ ì±„íŒ…ë°© í´ë¦­ (#ì‚°ì±…)
    Frontend->>DB: lifestylechatrooms ì¡°íšŒ (roomid)
    Frontend->>DB: lifestylechatparticipants INSERT/UPDATE (ì…ì¥)
    Frontend->>DB: lifestylechatmessages ì¡°íšŒ (ìµœê·¼ ë©”ì‹œì§€)
    DB->>Frontend: ë©”ì‹œì§€ ëª©ë¡ ë°˜í™˜

    Frontend->>Realtime: lifestylechatmessages í…Œì´ë¸” êµ¬ë… (roomid í•„í„°)
    Realtime->>Frontend: êµ¬ë… ì„±ê³µ
    Frontend->>User: ì±„íŒ…ë°© í™”ë©´ í‘œì‹œ

</div>

<h3>6.2. ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ ë° í•´ì‹œíƒœê·¸ ìë™ ì¶”ì¶œ</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL
    participant Trigger as Hashtag Trigger
    participant Realtime as Supabase Realtime
    participant OtherUsers as ë‹¤ë¥¸ ì‚¬ìš©ìë“¤

    User->>Frontend: ë©”ì‹œì§€ ì…ë ¥ (ì˜ˆ: "ì˜¤ëŠ˜ #ì‚°ì±… ê°”ì–´ìš”! #ë‚ ì”¨ì¢‹ìŒ")
    User->>Frontend: "ì „ì†¡" ë²„íŠ¼ í´ë¦­
    Frontend->>DB: lifestylechatmessages INSERT

    DB->>Trigger: process_lifestyle_chat_message_hashtags()
    Trigger->>Trigger: #{í…ìŠ¤íŠ¸} ì •ê·œì‹ ì¶”ì¶œ (#ì‚°ì±…, #ë‚ ì”¨ì¢‹ìŒ)
    Trigger->>DB: globalHashtags UPSERT (usageCount++, primaryCategory='lifestyle')
    Trigger->>DB: lifestylechatmessagehashtags INSERT

    DB->>Realtime: INSERT ì´ë²¤íŠ¸ ë°œí–‰
    Realtime->>Frontend: ì‹¤ì‹œê°„ ì•Œë¦¼ (ë‚´ ë©”ì‹œì§€)
    Realtime->>OtherUsers: ì‹¤ì‹œê°„ ì•Œë¦¼ (ë‹¤ë¥¸ ì‚¬ìš©ìë“¤)
    Frontend->>User: ë‚´ ë©”ì‹œì§€ ì¦‰ì‹œ í‘œì‹œ
    OtherUsers->>OtherUsers: ë©”ì‹œì§€ ìë™ ì¶”ê°€

</div>

<h3>6.3. ì‹¤ì‹œê°„ ì¸ê¸° í•´ì‹œíƒœê·¸ ì¡°íšŒ</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL

    Frontend->>DB: get_trending_hashtags_for_lifestyle(limit=5)
    DB->>DB: SELECT * FROM globalHashtags<br/>WHERE primaryCategory = 'lifestyle'<br/>ORDER BY usageCount DESC, updatedAt DESC
    DB->>Frontend: ì¸ê¸° í•´ì‹œíƒœê·¸ Top 5 ë°˜í™˜
    Frontend->>User: "ì¸ê¸° ì£¼ì œ" ì„¹ì…˜ì— í‘œì‹œ

    User->>Frontend: ì¸ê¸° í•´ì‹œíƒœê·¸ í´ë¦­ (ì˜ˆ: #ì‚°ì±…)
    Frontend->>DB: lifestylechatrooms ì¡°íšŒ (hashtagName = '#ì‚°ì±…')
    DB->>Frontend: ì±„íŒ…ë°© ì •ë³´ ë°˜í™˜
    Frontend->>User: í•´ë‹¹ ì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™

</div>

<hr />
<h2>ğŸ—ºï¸ 7. ë³‘ì› ì°¾ê¸° í”Œë¡œìš° (Kakao Map API)</h2>
<h3>7.1. ì£¼ë³€ ë³‘ì› ê²€ìƒ‰</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant Browser as Browser Geolocation
    participant KakaoAPI as Kakao Map API

    User->>Frontend: "ì£¼ë³€ ë³‘ì› ì°¾ê¸°" ë©”ë‰´ ì„ íƒ
    Frontend->>Browser: navigator.geolocation.getCurrentPosition()
    Browser->>Browser: ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­
    Browser->>Frontend: ì¢Œí‘œ ë°˜í™˜ (latitude, longitude)

    Frontend->>KakaoAPI: í‚¤ì›Œë“œ ê²€ìƒ‰ ("ë™ë¬¼ë³‘ì›", ì¢Œí‘œ, ë°˜ê²½ 3km)
    KakaoAPI->>Frontend: ë³‘ì› ëª©ë¡ ë°˜í™˜ (ì´ë¦„, ì£¼ì†Œ, ì „í™”ë²ˆí˜¸, ê±°ë¦¬)
    Frontend->>Frontend: ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ
    Frontend->>User: ë³‘ì› ëª©ë¡ + ì§€ë„ í‘œì‹œ

    User->>Frontend: íŠ¹ì • ë³‘ì› ì„ íƒ
    Frontend->>KakaoAPI: ì¥ì†Œ ìƒì„¸ ì •ë³´ ìš”ì²­
    KakaoAPI->>Frontend: ìƒì„¸ ì •ë³´ + í‰ì  + ë¦¬ë·°
    Frontend->>User: ìƒì„¸ ì •ë³´ íŒì—… í‘œì‹œ

</div>

<hr />
<h2>ğŸ” 8. íšŒì›íƒˆí‡´ í”Œë¡œìš°</h2>
<h3>8.1. ì™„ì „í•œ ë°ì´í„° ì‚­ì œ í”„ë¡œì„¸ìŠ¤</h3>
<div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Frontend as Next.js
    participant DB as PostgreSQL
    participant RPC as RPC Function

    User->>Frontend: ì„¤ì • â†’ "íšŒì›íƒˆí‡´" ë²„íŠ¼ í´ë¦­
    Frontend->>User: í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
    User->>Frontend: "íƒˆí‡´í•˜ê¸°" ìµœì¢… í™•ì¸

    Note over Frontend,RPC: 1. ì±„íŒ… ë°ì´í„° ì‚­ì œ
    Frontend->>DB: lifestylechatmessagehashtags DELETE
    Frontend->>DB: lifestylechatparticipants DELETE
    Frontend->>DB: lifestylechatmessages DELETE
    Frontend->>DB: lifestylechatrooms DELETE (ë³¸ì¸ ìƒì„± ë°©)

    Note over Frontend,RPC: 2. ì»¤ë®¤ë‹ˆí‹° ë°ì´í„° ì‚­ì œ
    Frontend->>DB: communityPostHashtags DELETE
    Frontend->>DB: postcomments DELETE
    Frontend->>DB: postlikes DELETE
    Frontend->>DB: communityPosts DELETE

    Note over Frontend,RPC: 3. í”Œë˜ë„ˆ ë°ì´í„° ì‚­ì œ
    Frontend->>DB: plannerEventHashtags DELETE
    Frontend->>DB: plannerEvents DELETE
    Frontend->>DB: plannerExpenses DELETE

    Note over Frontend,RPC: 4. ë°˜ë ¤ë™ë¬¼ ë°ì´í„° ì‚­ì œ
    Frontend->>DB: palVaccinations DELETE
    Frontend->>DB: palHealthRecords DELETE
    Frontend->>DB: palProfiles DELETE

    Note over Frontend,RPC: 5. RAG ì§€ì‹ ë² ì´ìŠ¤ ì‚­ì œ
    Frontend->>DB: pet_knowledge_base DELETE

    Note over Frontend,RPC: 6. ì‚¬ìš©ì í”„ë¡œí•„ ì‚­ì œ
    Frontend->>DB: notificationsettings DELETE
    Frontend->>DB: profileCompletion DELETE
    Frontend->>DB: profiles DELETE

    Note over Frontend,RPC: 7. Auth ê³„ì • ì‚­ì œ
    Frontend->>RPC: delete_user_account(userId)
    RPC->>DB: auth.users DELETE

    DB->>Frontend: íƒˆí‡´ ì™„ë£Œ
    Frontend->>Frontend: ì„¸ì…˜ ì¢…ë£Œ (ë¡œê·¸ì•„ì›ƒ)
    Frontend->>User: ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

</div>

<p><strong>íƒˆí‡´ ë¡œì§ íŠ¹ì§•</strong>:</p>
<ul>
<li><strong>ì™„ì „í•œ ë°ì´í„° ì‚­ì œ</strong>: ë¼ì´í”„ìŠ¤íƒ€ì¼ ì±„íŒ…, RAG ì§€ì‹ ë² ì´ìŠ¤ í¬í•¨</li>
<li><strong>ê´€ë¦¬ììš© í•¨ìˆ˜</strong>: <code>admin_delete_user_completely(userId)</code> ìƒì„±</li>
<li><strong>í…Œì´ë¸”ëª… ì •í™• êµ¬ë¶„</strong>: CamelCase vs ì†Œë¬¸ì ë„¤ì´ë° ì •í™•íˆ ì²˜ë¦¬</li>
</ul>
<hr />
<h2>ğŸ“± 9. ë°˜ì‘í˜• ë””ìì¸ ì ìš© í”Œë¡œìš°</h2>
<h3>9.1. 4ë‹¨ê³„ ë¸Œë ˆì´í¬í¬ì¸íŠ¸ ì‹œìŠ¤í…œ</h3>
<div class="mermaid">
graph TB
    User[ì‚¬ìš©ì ì ‘ì†] --> Device{ë””ë°”ì´ìŠ¤ í¬ê¸° ê°ì§€}

    Device -->|1281px ì´ìƒ| Desktop[Desktop ë ˆì´ì•„ì›ƒ]
    Device -->|901-1280px| Medium[ì¤‘í˜• í™”ë©´ ë ˆì´ì•„ì›ƒ]
    Device -->|769-900px| Small[ì†Œí˜• í™”ë©´ ë ˆì´ì•„ì›ƒ]
    Device -->|400-768px| Mobile[ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒ]
    Device -->|400px ì´í•˜| Tiny[ì´ˆì†Œí˜• ëª¨ë°”ì¼]

    Desktop --> Render[í˜ì´ì§€ ë Œë”ë§]
    Medium --> Render
    Small --> Render
    Mobile --> Render
    Tiny --> Render

    Render --> Display[ì‚¬ìš©ìì—ê²Œ í‘œì‹œ]

    style Desktop fill:#4CAF50
    style Medium fill:#8BC34A
    style Small fill:#FFC107
    style Mobile fill:#FF9800
    style Tiny fill:#FF5722

</div>

<p><strong>ë°˜ì‘í˜• ì ìš© ì›ì¹™</strong>:</p>
<ul>
<li><strong>Desktop (1281px+)</strong>: ê¸°ë³¸ ìŠ¤íƒ€ì¼</li>
<li><strong>ì¤‘í˜• (901-1280px)</strong>: ê°„ê²©/í°íŠ¸ -10%</li>
<li><strong>ì†Œí˜• (769-900px)</strong>: ê°„ê²©/í°íŠ¸ -20%, ê·¸ë¦¬ë“œ ì¶•ì†Œ</li>
<li><strong>ëª¨ë°”ì¼ (400-768px)</strong>: ì„¸ë¡œ ë°°ì¹˜, ì „ì²´ ë„ˆë¹„</li>
<li><strong>ì´ˆì†Œí˜• (400px-)</strong>: ìµœì†Œ íŒ¨ë”©, ì´ˆì†Œí˜• í°íŠ¸</li>
</ul>
<hr />
<h2>ğŸ¯ ì£¼ìš” ê¸°ìˆ ì  íŠ¹ì§• ìš”ì•½</h2>
<h3>1. Supabase Realtime í™œìš©</h3>
<ul>
<li><strong>ì‹¤ì‹œê°„ ëŒ“ê¸€</strong>: postcomments í…Œì´ë¸” êµ¬ë…</li>
<li><strong>ì‹¤ì‹œê°„ ì±„íŒ…</strong>: lifestylechatmessages í…Œì´ë¸” êµ¬ë…</li>
<li><strong>ì¢‹ì•„ìš” ìë™ ì—…ë°ì´íŠ¸</strong>: postlikes íŠ¸ë¦¬ê±°</li>
</ul>
<h3>2. íŠ¸ë¦¬ê±° ê¸°ë°˜ ìë™í™”</h3>
<ul>
<li><strong>í•´ì‹œíƒœê·¸ ìë™ ì¶”ì¶œ</strong>: #{í…ìŠ¤íŠ¸} ì •ê·œì‹</li>
<li><strong>ë°±ì‹ -í”Œë˜ë„ˆ ë™ê¸°í™”</strong>: ì–‘ë°©í–¥ ì‹¤ì‹œê°„ ì—°ë™</li>
<li><strong>ì¢‹ì•„ìš” ì¹´ìš´íŒ…</strong>: likesCount ìë™ ì§‘ê³„</li>
<li><strong>RAG ì„ë² ë”©</strong>: ê²Œì‹œê¸€ ì‘ì„± ì‹œ ìë™ ìƒì„±</li>
</ul>
<h3>3. Hook Composition ì•„í‚¤í…ì²˜</h3>
<ul>
<li><strong>ì „ë¬¸í™”ëœ í›…</strong>: ê¸°ëŠ¥ë³„ ë…ë¦½ì  í›…</li>
<li><strong>Co-location</strong>: ê¸°ëŠ¥ì— í•„ìš”í•œ ëª¨ë“  íŒŒì¼ì„ í•˜ë‚˜ì˜ í´ë”ì—</li>
<li><strong>ì¬ì‚¬ìš©ì„±</strong>: í‰ê·  60% ì½”ë“œ ì¶•ì†Œ</li>
</ul>
<h3>4. ë°˜ì‘í˜• ë””ìì¸</h3>
<ul>
<li><strong>4ë‹¨ê³„ ë¸Œë ˆì´í¬í¬ì¸íŠ¸</strong>: 400px~1280px+</li>
<li><strong>Flexbox ë†’ì´ í†µì œ</strong>: <code>align-items: stretch</code> + <code>min-height: 0</code></li>
<li><strong>Sticky + Tooltip ê³µì¡´</strong>: <code>overflow: visible</code> + Z-Index ë ˆì´ì–´ë§</li>
</ul>
<hr />
<p><strong>ğŸ“ ë¬¸ì„œ ì •ë³´</strong></p>
<ul>
<li><strong>ì‘ì„±ì¼</strong>: 2025-11-14</li>
<li><strong>ì‘ì„±ì</strong>: LYSS with Claude</li>
<li><strong>ë²„ì „</strong>: v4.0 (4ì°¨ ìŠ¤í”„ë¦°íŠ¸)</li>
<li><strong>ì´ì „ ë¬¸ì„œ</strong>: <a href="./02_WBS_ìµœì‹ í™”.md">02_WBS_ìµœì‹ í™”.md</a></li>
<li><strong>ë‹¤ìŒ ë¬¸ì„œ</strong>: <a href="./04_ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜.md">04_ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜.md</a></li>
</ul>

    <script>
        // Mermaid ë Œë”ë§ ì™„ë£Œ í›„ í˜ì´ì§€ ë¡œë“œ ì´ë²¤íŠ¸
        window.addEventListener('load', function() {
            console.log('Mermaid diagrams loaded successfully!');
        });
    </script>
</body>
</html>
