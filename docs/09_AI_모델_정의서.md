# Fetpal AI 모델 정의서
## 반려동물 통합 AI 진단 시스템 (YOLO + RAG + LLM)

**작성자**: LYSS with Claude
**작성일**: 2025-11-14  
**프로젝트명**: Fetpal - AI 기반 반려동물 건강 케어 플랫폼  
**통합 모델**: 3개 YOLOv8m 모델 + RAG System + Multi-LLM  
**모델 버전**: v2.0 (4차 스프린트 최종)

---

## 🎯 프로젝트 개요

본 프로젝트는 반려동물의 **피부질환**, **안구질환**, **건강상태**를 통합적으로 진단하는 AI 시스템입니다.

### 핵심 기능

**1. YOLO 기반 객체 탐지**
- 3개 독립 모델로 다양한 질환 감지
- FastAPI 서버를 통한 고속 추론

**2. RAG 기반 지식 검색 ⭐⭐⭐**
- pgvector (384차원) 벡터 유사도 검색
- 커뮤니티 경험담 자동 연결
- HuggingFace 임베딩 생성

**3. Multi-LLM 통합 ⭐⭐⭐**
- OpenAI GPT-4
- Google Gemini
- Anthropic Claude
- 사용자가 원하는 LLM 선택 가능

### 시스템 구성

| 모델명 | 탐지 대상 | 클래스 수 | 데이터셋 규모 | 성능 (mAP50) |
|--------|----------|-----------|--------------|--------------|
| **Skin Model** | 피부질환 | 6개 | 232,253개 | 18.3% |
| **Eyes Model** | 안구질환 | 30개 | 217,547개 | 25.4% |
| **Health Model** | 건강상태 | 3개 | 108,000개+ | 88.2% |

**통합 기능:**
- 3개 YOLO 모델의 병렬 추론
- RAG System을 통한 커뮤니티 경험담 검색 (pgvector)
- Multi-LLM 기반 진단 설명 생성 (GPT-4, Gemini, Claude)
- Next.js App Router 기반 프론트엔드 통합

---

## 📌 목차
1. [AI 모델 정의](#1-ai-모델-정의)
   - 1.1 [Skin Model - 피부질환](#11-skin-model---피부질환)
   - 1.2 [Eyes Model - 안구질환](#12-eyes-model---안구질환)
   - 1.3 [Health Model - 건강상태](#13-health-model---건강상태)
2. [데이터 모델](#2-데이터-모델)
3. [시스템 아키텍처](#3-시스템-아키텍처)
4. [AI 진단 플로우](#4-ai-진단-플로우)
5. [RAG 시스템](#5-rag-시스템)
6. [성능 지표](#6-성능-지표)

---

## 1. AI 모델 정의

### 공통 모델 사양

| 항목 | 내용 |
|------|------|
| **모델 아키텍처** | YOLOv8m (You Only Look Once v8 Medium) |
| **모델 유형** | 객체 탐지 (Object Detection) |
| **프레임워크** | Ultralytics YOLO |
| **입력 크기** | 640 × 640 pixels |
| **출력 형식** | Bounding Box + 클래스 확률 + 신뢰도 |
| **파라미터 수** | 약 25.9M (Medium 모델 기준) |
| **학습 환경** | NVIDIA RTX 4060 (8GB VRAM) |

---

## 1.1 Skin Model - 피부질환

### 1.1.1 모델 개요

| 항목 | 내용 |
|------|------|
| **모델 파일** | `skin_yolov8m_best.pt` (52MB) |
| **학습 기간** | 28 Epochs, 약 38시간 |
| **클래스 수** | 6개 |
| **데이터셋** | 232,253개 이미지 |
| **최종 mAP50** | 18.3% |

### 1.1.2 학습 클래스 정의 (6개)

```python
# 클래스 ID와 질환명 매핑
class_mapping = {
    0: 'A1_구진_플라크',              # Papule & Plaque
    1: 'A2_비듬_각질_상피성잔고리',    # Dandruff & Scale
    2: 'A3_태선화_과다색소침착',       # Lichenification & Hyperpigmentation
    3: 'A4_농포_여드름',              # Pustule & Acne
    4: 'A5_미란_궤양',                # Erosion & Ulcer
    5: 'A6_결절_종괴'                 # Nodule & Mass
}
```

**클래스별 특징:**

| 클래스 ID | 질환명 | 주요 특징 | 데이터 개수 |
|-----------|--------|----------|-------------|
| **0** | A1_구진_플라크 | 피부 위 돌출된 구진, 편평한 플라크 | 36,635개 |
| **1** | A2_비듬_각질_상피성잔고리 | 각질, 비듬, 하얀 상피성 잔고리 | 88,365개 |
| **2** | A3_태선화_과다색소침착 | 피부 두꺼워짐, 색소 침착 | 60,911개 |
| **3** | A4_농포_여드름 | 화농성 병변, 고름 형성 | 38,089개 |
| **4** | A5_미란_궤양 | 표면 손상, 궤양, 상처 | 13,884개 |
| **5** | A6_결절_종괴 | 깊은 결절, 종괴, 덩어리 | 21,573개 |

### 1.1.3 하이퍼파라미터 설정

```yaml
# Skin Model 학습 설정
epochs: 28
batch_size: 8
image_size: 640
optimizer: SGD
lr0: 0.01
momentum: 0.937
weight_decay: 0.0005
```

### 1.1.4 성능 지표

- **mAP50**: 18.3%
- **mAP50-95**: 8.3%
- **Precision**: 31.8%
- **Recall**: 23.1%

---

## 1.2 Eyes Model - 안구질환

### 1.2.1 모델 개요

| 항목 | 내용 |
|------|------|
| **모델 파일** | `eyes_yolov8m_best.pt` (50MB) |
| **학습 기간** | 28 Epochs, 약 72시간 (3일) |
| **클래스 수** | 30개 |
| **데이터셋** | 217,547개 이미지 |
| **최종 mAP50** | 25.35% |

### 1.2.2 학습 클래스 정의 (30개)

```python
# 안구질환 클래스 (개 24개 + 고양이 6개)
eyes_classes = {
    # 개 안구질환 (0-23)
    0: '결막염_무', 1: '결막염_유',
    2: '궤양성각막질환_무', 3: '궤양성각막질환_상', 4: '궤양성각막질환_하',
    5: '백내장_무', 6: '백내장_초기', 7: '백내장_비성숙', 8: '백내장_성숙',
    9: '비궤양성각막질환_무', 10: '비궤양성각막질환_상', 11: '비궤양성각막질환_하',
    12: '색소침착성각막염_무', 13: '색소침착성각막염_유',
    14: '안검내반증_무', 15: '안검내반증_유',
    16: '안검염_무', 17: '안검염_유',
    18: '안검종양_무', 19: '안검종양_유',
    20: '유루증_무', 21: '유루증_유',
    22: '핵경화_무', 23: '핵경화_유',
    
    # 고양이 안구질환 (24-29)
    24: '각막궤양_무', 25: '각막궤양_유',
    26: '각막부골편_무', 27: '각막부골편_유',
    28: '비궤양성각막염_무', 29: '비궤양성각막염_유'
}
```

**클래스 명명 규칙:**
- **무(無)**: 질병 없음 (정상)
- **유(有)**: 질병 있음
- **상(上)**: 심각도 높음
- **하(下)**: 심각도 낮음
- **초기/비성숙/성숙**: 백내장 진행 단계

**데이터 구성:**
- 개(Dog) 안구질환: 24개 클래스
- 고양이(Cat) 안구질환: 6개 클래스
- 훈련 데이터: 193,134개 (개 이미지)
- 검증 데이터: 24,413개 (고양이 이미지)

### 1.2.3 하이퍼파라미터 설정

```yaml
# Eyes Model 학습 설정
epochs: 28
batch_size: 16
image_size: 640
optimizer: SGD
lr0: 0.01
momentum: 0.937
weight_decay: 0.0005
workers: 4
```

### 1.2.4 성능 지표

- **mAP50**: 25.35%
- **mAP50-95**: 21.48%
- **주요 클래스 성능**:
  - 백내장_무: mAP50 49.3%
  - 궤양성각막질환_상: mAP50 53.4%
  - 백내장_초기: mAP50 37.4%

---

## 1.3 Health Model - 건강상태

### 1.3.1 모델 개요

| 항목 | 내용 |
|------|------|
| **모델 파일** | `health_yolov8m_best.pt` (52MB) |
| **학습 기간** | 28 Epochs, 약 21.5시간 |
| **클래스 수** | 3개 |
| **데이터셋** | 108,000개+ 이미지 |
| **최종 mAP50** | 88.2% ⭐ (최고 성능!) |

### 1.3.2 학습 클래스 정의 (3개)

```python
# 건강상태 클래스
health_classes = {
    0: 'full_body',  # 전신 (Body-Part 01-13)
    1: 'head',       # 두상 (Body-Part 14-19)
    2: 'nose'        # 코/비문 (Body-Part 20)
}
```

**클래스별 특징:**

| 클래스 ID | 부위명 | 설명 | AI Hub 매핑 |
|-----------|--------|------|-------------|
| **0** | full_body | 반려동물 전신 | Body-Part 01-13 |
| **1** | head | 머리/두상 | Body-Part 14-19 |
| **2** | nose | 코/비문 | Body-Part 20 |

**데이터 출처:**
- AI Hub 반려견, 반려묘 건강정보 데이터
- 반려견: 개체식별, 건강관리용
- 반려묘: 개체식별, 건강관리용

**데이터 구성:**
- 훈련 데이터: 약 96,000개
- 검증 데이터: 약 12,000개
- 반려견(Dog): 94%, 반려묘(Cat): 6%

### 1.3.3 하이퍼파라미터 설정

```yaml
# Health Model 학습 설정
epochs: 28
batch_size: 16
image_size: 640
optimizer: SGD
lr0: 0.01
momentum: 0.937
weight_decay: 0.0005
workers: 4
```

### 1.3.4 성능 지표 (최고 성능!)

- **mAP50**: 88.2% ⭐
- **mAP50-95**: 77.1%
- **클래스별 성능**:
  - full_body: mAP50 98.8%, mAP50-95 95.9%
  - head: mAP50 86.8%, mAP50-95 71.9%
  - nose: mAP50 78.9%, mAP50-95 63.5%

---

## 1.4 통합 모델 아키텍처

### YOLOv8m 공통 구조

```
입력 이미지 (640×640×3)
    ↓
[Backbone - CSPDarknet53]
    - Conv Layer (Focus)
    - C2f Modules (Cross Stage Partial with 2 Convolutions + Faster)
    - SPPF (Spatial Pyramid Pooling Fast)
    ↓
[Neck - PAN (Path Aggregation Network)]
    - FPN (Feature Pyramid Network) - Top-down pathway
    - Bottom-up pathway
    ↓
[Head - Detection Head]
    - 3개의 Detection Scale (Small/Medium/Large objects)
    - Bounding Box Regression
    - Class Probability (6 classes)
    - Objectness Score
    ↓
출력: [x, y, w, h, confidence, class_id]
```

**주요 레이어 구성:**
- **Backbone**: CSPDarknet53 (특징 추출)
- **Neck**: PANet (다중 스케일 특징 융합)
- **Head**: Decoupled Head (분류 + 위치 예측 분리)

### 1.5 손실 함수 (Loss Function)

YOLO는 3가지 손실 함수를 결합하여 사용합니다:

```python
Total_Loss = λ1·Box_Loss + λ2·Class_Loss + λ3·DFL_Loss
```

1. **Box Loss (Bounding Box Loss)**
   - CIoU Loss (Complete Intersection over Union)
   - 바운딩 박스 위치와 크기의 정확도 측정

2. **Class Loss (Classification Loss)**
   - Binary Cross Entropy Loss
   - 클래스 분류 정확도 측정

3. **DFL Loss (Distribution Focal Loss)**
   - 객체 존재 확률 측정
   - 배경과 객체를 구분

---

## 2. 데이터 모델

### 2.1 통합 데이터셋 통계

| 모델 | 전체 이미지 | 훈련 데이터 | 검증 데이터 | 클래스 수 |
|------|-------------|-------------|-------------|-----------|
| **Skin** | 232,253개 | 185,802개 (80%) | 46,451개 (20%) | 6개 |
| **Eyes** | 217,547개 | 193,134개 (89%) | 24,413개 (11%) | 30개 |
| **Health** | 108,000+개 | ~96,000개 (89%) | ~12,000개 (11%) | 3개 |
| **총합** | **557,800+개** | ~474,936개 | ~82,864개 | **39개** |

### 2.2 Skin Model 데이터셋 구조

```
SKIN_YOLO_DATASET/
├── images/
│   ├── train/              # 훈련 이미지 (185,802개)
│   │   ├── img_0001.jpg
│   │   └── ...
│   └── val/                # 검증 이미지 (46,451개)
│       ├── img_0001.jpg
│       └── ...
└── labels/
    ├── train/              # 훈련 라벨 (YOLO 형식)
    │   ├── img_0001.txt
    │   └── ...
    └── val/                # 검증 라벨
        ├── img_0001.txt
        └── ...
```

**클래스 분포:**

```
A2_비듬각질 ████████████████████████████ 88,365 (38.1%)
A3_태선화   ████████████████████ 60,911 (26.2%)
A4_농포     ████████████ 38,089 (16.4%)
A1_구진     ████████████ 36,635 (15.8%)
A6_결절     ██████ 21,573 (9.3%)
A5_미란     ████ 13,884 (6.0%)
```

### 2.3 Eyes Model 데이터셋 구조

```
EYES_YOLO_DATASET/
├── images/
│   ├── train/              # 훈련 이미지 (193,134개 - 개)
│   │   ├── dog_eye_001.jpg
│   │   └── ...
│   └── val/                # 검증 이미지 (24,413개 - 고양이)
│       ├── cat_eye_001.jpg
│       └── ...
└── labels/
    ├── train/              # 훈련 라벨
    │   ├── dog_eye_001.txt
    │   └── ...
    └── val/                # 검증 라벨
        ├── cat_eye_001.txt
        └── ...
```

**안구질환 분포:**
- 개(Dog) 안구질환: 24개 클래스 (193,134개 이미지)
- 고양이(Cat) 안구질환: 6개 클래스 (24,413개 이미지)

### 2.4 Health Model 데이터셋 구조

```
HEALTH_YOLO_DATASET/
├── images/
│   ├── train/              # 훈련 이미지 (~96,000개)
│   │   ├── pet_001.jpg
│   │   └── ...
│   └── valid/              # 검증 이미지 (~12,000개)
│       ├── pet_001.jpg
│       └── ...
└── labels/
    ├── train/              # 훈련 라벨
    │   ├── pet_001.txt
    │   └── ...
    └── valid/              # 검증 라벨
        ├── pet_001.txt
        └── ...
```

**건강상태 분포:**
- full_body (전신): 주요 클래스
- head (머리): 중간 빈도
- nose (코/비문): 개체식별용

### 2.5 YOLO 라벨 형식

각 이미지마다 `.txt` 파일로 라벨링되어 있습니다:

```txt
# 파일명: img_0001.txt
# 형식: <class_id> <x_center> <y_center> <width> <height>
# 좌표는 정규화됨 (0.0 ~ 1.0)

0 0.512 0.345 0.123 0.089
2 0.678 0.567 0.145 0.234
```

**각 필드 설명:**
- `class_id`: 클래스 ID (Skin: 0~5, Eyes: 0~29, Health: 0~2)
- `x_center`: 바운딩 박스 중심 X 좌표 (정규화)
- `y_center`: 바운딩 박스 중심 Y 좌표 (정규화)
- `width`: 바운딩 박스 너비 (정규화)
- `height`: 바운딩 박스 높이 (정규화)

---

## 3. 시스템 아키텍처

### 3.1 전체 시스템 구조 (Fetpal 통합 환경)

```
┌─────────────────────────────────────────────────────────────────┐
│                    사용자 인터페이스 (Next.js 14)                 │
│                   App Router + Hook Composition                  │
└───────────────────────────┬─────────────────────────────────────┘
                            │
            ┌───────────────┼───────────────┐
            ↓               ↓               ↓
    ┌───────────────┐ ┌──────────────┐ ┌──────────────┐
    │  Supabase     │ │  FastAPI     │ │  External    │
    │  BaaS         │ │  AI Server   │ │  APIs        │
    └───────┬───────┘ └──────┬───────┘ └──────┬───────┘
            │                │                 │
    ┌───────┼────────┐      │         ┌───────┼────────┐
    ↓       ↓        ↓      ↓         ↓       ↓        ↓
┌───────┐ ┌────┐ ┌────┐ ┌──────┐ ┌─────┐ ┌───────┐ ┌──────┐
│Post   │ │Auth│ │Stor│ │YOLO  │ │GPT-4│ │Gemini │ │Claude│
│greSQL │ │JWT │ │age │ │3모델 │ └─────┘ └───────┘ └──────┘
│+pgvec │ └────┘ └────┘ └──────┘
│tor    │
└───┬───┘
    │
┌───┴────────────────┐
│ RAG Knowledge Base │
│ pet_knowledge_base │
│ (384D Vectors)     │
└────────────────────┘
```

### 3.2 처리 흐름 (AI Assistant Pipeline)

```
1. 사용자 이미지 업로드
   ↓
2. Next.js Frontend (useYoloDetection Hook)
   ↓
3. FastAPI Server로 전송
   ├─ /api/detect-health (전신 건강)
   ├─ /api/detect-eyes (안구질환)
   └─ /api/detect-skin (피부질환)
   ↓
4. YOLO 모델 추론 (병렬 처리 가능)
   ├─ Health Model (88.2% mAP50) ⭐
   ├─ Eyes Model (25.4% mAP50)
   └─ Skin Model (18.3% mAP50)
   ↓
5. 바운딩 박스 + 신뢰도 반환
   {
     "detections": [
       {"class": "A1_구진_플라크", "conf": 0.82, "bbox": [x,y,w,h]},
       {"class": "full_body", "conf": 0.95, "bbox": [x,y,w,h]}
     ],
     "annotated_image": "data:image/jpeg;base64,..."
   }
   ↓
6. Frontend에서 결과 시각화
   ↓
7. (선택) RAG 시스템 검색
   ↓
8. (선택) Multi-LLM 조언 생성
   ├─ OpenAI GPT-4
   ├─ Google Gemini
   └─ Anthropic Claude
   ↓
9. 최종 결과 표시
   - 이미지 + 바운딩 박스
   - 탐지된 질환 목록
   - AI 조언 (선택)
   - 유사 경험담 (RAG)
```

### 3.3 배포 환경 (Fetpal 프로젝트 기준)

| 구성 요소 | 기술 스택 | 비고 |
|-----------|----------|------|
| **Frontend** | Next.js 14 App Router | Hook Composition 패턴 |
| **BaaS** | Supabase | PostgreSQL + Auth + Storage + Realtime |
| **AI Server** | FastAPI (Python 3.10) | YOLO 추론 서버 |
| **YOLO 모델** | PyTorch + Ultralytics | GPU 추론 (RTX 4060) |
| **Vector DB** | pgvector (384차원) | RAG 지식 베이스 |
| **LLM** | OpenAI / Google / Anthropic | Multi-LLM 지원 |
| **Embedding** | HuggingFace API | sentence-transformers |
| **HTTP Client** | fetch API | 네이티브 브라우저 API |

---

## 4. AI 진단 플로우 (사용자 관점)

### 4.1. YOLO 이미지 분석 프로세스 (시퀀스 다이어그램 형식)

```
사용자 → Frontend: 이미지 업로드 (Drag & Drop)
Frontend → Frontend: 이미지 미리보기 표시
사용자 → Frontend: "분석 시작" 버튼 클릭
Frontend → FastAPI: POST /api/detect (이미지 + 모델 선택)
FastAPI → YOLO: 이미지 전처리 (640x640) 및 추론
YOLO → YOLO: 바운딩 박스 + 신뢰도 계산
YOLO → FastAPI: 탐지 결과 반환
FastAPI → FastAPI: 결과 이미지 생성 (바운딩 박스 표시)
FastAPI → Frontend: JSON 응답 (탐지 결과 + 이미지 URL)
Frontend → 사용자: 탐지 결과 시각화

사용자 → Frontend: "AI 조언 받기" 버튼 클릭
Frontend → LLM: 탐지 결과 + 프롬프트 전송
LLM → Frontend: 상황 대처 방안 + 병원 추천
Frontend → 사용자: AI 조언 표시
```

**지원 모델**:
- **Health 모델**: 전신 건강 체크 (3개 클래스)
- **Eyes 모델**: 안구질환 감지 (30개 클래스)
- **Skin 모델**: 피부질환 감지 (6개 클래스)

---

## 5. RAG 시스템 (pgvector 기반 지식 검색) ⭐⭐⭐

### 5.1. RAG 시스템 개요

**RAG (Retrieval-Augmented Generation)**:
- 사용자 질문을 벡터로 변환 (HuggingFace 384차원)
- pgvector로 유사도 검색 (Cosine Similarity)
- 커뮤니티 게시글 중 유사한 경험담 Top 5 반환
- LLM에게 검색 결과를 컨텍스트로 제공하여 신뢰도 높은 답변 생성

### 5.2. pet_knowledge_base 테이블 구조

```sql
CREATE TABLE pet_knowledge_base (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  content TEXT NOT NULL,                    -- 게시글 내용
  embedding VECTOR(384),                    -- HuggingFace 임베딩 (384차원)
  source TEXT CHECK (source IN ('community', 'faq', 'youtube', 'manual')),
  source_url TEXT,                          -- 원본 게시글 URL
  quality_score NUMERIC(3,2) CHECK (quality_score >= 0 AND quality_score <= 1),
  is_verified BOOLEAN DEFAULT FALSE,        -- 수의사 검증 여부
  metadata JSONB,                           -- 추가 정보 (해시태그, 작성자 등)
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- Vector Similarity Search Index
CREATE INDEX ON pet_knowledge_base USING ivfflat (embedding vector_cosine_ops);
```

### 5.3. RAG 검색 플로우

```
사용자 → Frontend: "비슷한 경험 찾기" 클릭
Frontend → HuggingFace: 질문 텍스트 임베딩 생성 (384차원)
HuggingFace → Frontend: 임베딩 벡터 반환
Frontend → PostgreSQL: search_similar_knowledge(벡터, 임계값, 개수)
PostgreSQL → PostgreSQL: 코사인 유사도 계산 (Vector Search)
PostgreSQL → Frontend: 유사한 게시글 Top 5 반환
Frontend → 사용자: 커뮤니티 경험담 표시

(선택) AI 조언 생성:
Frontend → LLM: 검색 결과 + 사용자 질문 전송
LLM → LLM: RAG 방식으로 답변 생성
LLM → Frontend: 신뢰도 높은 답변 반환
Frontend → 사용자: AI 조언 표시
```

**RAG 시스템 특징**:
- **자동 임베딩**: 커뮤니티 게시글 작성 시 트리거 기반 자동 생성
- **품질 관리**: quality_score (0.00-1.00) + is_verified 플래그
- **출처 추적**: source (community, faq, youtube, manual)
- **응답 시간**: 평균 0.5초 이내 (200% 목표 달성!)

---

## 6. 성능 지표

### 6.1 통합 모델 성능 비교

| 모델 | mAP50 | mAP50-95 | Precision | Recall | 학습시간 | 클래스 수 | 평가 |
|------|-------|----------|-----------|--------|----------|-----------|------|
| **Skin** | 18.3% | 8.3% | 31.8% | 23.1% | 38시간 | 6개 | ⚠️ 미흡 |
| **Eyes** | 25.4% | 21.5% | - | - | 72시간 | 30개 | ⚠️ 미흡 |
| **Health** | **88.2%** ⭐ | **77.1%** ⭐ | - | - | 21.5시간 | 3개 | **✅ 우수** |
| **평균** | 44.0% | 35.6% | - | - | 131.5시간 | 39개 | - |

### 6.2 모델별 학습 결과

#### Skin Model 학습 손실

| Epoch | Box Loss | Class Loss | DFL Loss | Total Loss |
|-------|----------|------------|----------|------------|
| 1 | 2.500 | 3.772 | 1.942 | 8.214 |
| 14 | 2.297 | 3.135 | 1.774 | 7.206 |
| 28 | 2.073 | 2.531 | 1.650 | 6.254 |

**손실 감소율:**
- Box Loss: 17.1% 감소
- Class Loss: 32.9% 감소  
- DFL Loss: 15.0% 감소

#### Eyes Model 성능 (우수 클래스)

| 클래스 | mAP50 | mAP50-95 | 특징 |
|--------|-------|----------|------|
| 백내장_무 | 49.3% | 48.8% | 가장 높은 정확도 |
| 궤양성각막질환_상 | 53.4% | 53.3% | 심각도 높은 질환 잘 검출 |
| 백내장_초기 | 37.4% | 36.0% | 초기 단계 검출 가능 |
| 결막염_유 | 27.9% | 25.1% | 일반적 질환 검출 |

#### Health Model 성능 (최고!)

| 클래스 | mAP50 | mAP50-95 | Precision | Recall |
|--------|-------|----------|-----------|--------|
| full_body | 98.8% ⭐ | 95.9% | 높음 | 높음 |
| head | 86.8% | 71.9% | 중간 | 중간 |
| nose | 78.9% | 63.5% | 보통 | 보통 |

### 6.3 학습 시간 및 리소스

| 모델 | 총 학습시간 | 1 Epoch 시간 | GPU 사용률 | GPU 메모리 | 학습 이미지 수 |
|------|-------------|--------------|------------|------------|----------------|
| **Skin** | 38시간 | ~82분 | 95% | 7.2GB/8GB | 185,802개 |
| **Eyes** | 72시간 | ~154분 | 90% | 6.8GB/8GB | 193,134개 |
| **Health** | 21.5시간 | ~46분 | 85% | 5.5GB/8GB | ~96,000개 |
| **총합** | 131.5시간 | - | - | - | 474,936개 |

### 6.4 성능 분석 및 문제점

#### ✅ 우수한 점

1. **Health Model의 뛰어난 성능 (88.2% mAP50)**
   - 클래스가 3개로 단순하여 학습이 용이
   - 데이터 품질이 우수 (AI Hub 공공 데이터)
   - full_body 검출 98.8%로 매우 높은 정확도

2. **Eyes Model의 광범위한 질환 커버 (30개 클래스)**
   - 개 24개 + 고양이 6개 안구질환 통합
   - 주요 질환(백내장, 궤양성각막질환) 검출 정확도 50% 이상
   - 심각도 단계별 분류 가능 (무/유/상/하/초기/비성숙/성숙)

3. **Skin Model의 대규모 데이터셋 (232,253개)**
   - 가장 많은 이미지 데이터 활용
   - 6개 피부질환 클래스 균형적 분포
   - 실무 적용 가능한 규모

#### ⚠️ 개선이 필요한 점

1. **Skin Model의 낮은 mAP (18.3%)**
   - 원인: 하이퍼파라미터 자동 최적화 설정 문제
   - 학습 중반에 성능 급락 발생
   - 데이터 불균형 (A5: 13,884개 vs A2: 88,365개)

2. **Eyes Model의 클래스 복잡도**
   - 30개 클래스로 인한 학습 난이도 증가
   - 일부 클래스(핵경화, 각막부골편) 낮은 정확도
   - 개와 고양이 데이터 불균형 (9:1 비율)

3. **전체적인 학습 시간**
   - 총 131.5시간 (약 5.5일) 소요
   - GPU 연속 가동에 따른 부담
   - 추가 실험이 어려운 환경

### 6.5 개선 방안

#### Skin Model 개선

1. **하이퍼파라미터 재조정**
   - `optimizer: auto` → `optimizer: SGD` (수동 설정)
   - Learning Rate 감소: 0.01 → 0.001
   - Batch Size 증가: 8 → 16

2. **데이터 증강 강화**
   - Mixup, CutMix 추가
   - Class-balanced Sampling 적용
   - 데이터 재샘플링으로 A5 클래스 증강

3. **학습 전략 변경**
   - Epoch 수 증가: 28 → 100
   - Early Stopping 적극 활용
   - Warmup Epoch 증가: 3 → 5

#### Eyes Model 개선

1. **클래스 통합**
   - 유사 클래스 통합 (무/유만 남기고 상/하 제거)
   - 30개 → 15개 클래스로 단순화
   - 학습 난이도 감소

2. **데이터 밸런싱**
   - 고양이 데이터 증강 (24,413개 → 50,000개)
   - 저빈도 클래스 오버샘플링
   - Focal Loss 적용

#### Health Model 개선

1. **추가 클래스 확장**
   - 현재 3개 → 10개 이상 신체 부위
   - 더 세밀한 건강 상태 분류
   - 질병 여부까지 검출 확장

2. **성능 유지 전략**
   - 현재 높은 성능 유지
   - 추가 데이터 수집으로 일반화 성능 향상
   - 실시간 추론 최적화 (ONNX 변환)

---

## 📊 부록: 시각화 자료

### A1. Skin Model - 학습 곡선
- 파일: `1_성능지표_그래프/학습곡선_결과.png`
- 내용: Box Loss, Class Loss, mAP50, Precision, Recall

### A2. Skin Model - 혼동 행렬
- 파일: `1_성능지표_그래프/혼동행렬.png`
- 내용: 6개 클래스별 예측 정확도

### A3. Skin Model - 데이터 분포
- 파일: `4_데이터_분포/데이터_분포도.jpg`
- 내용: 클래스별 이미지 개수 분포

### A4. Skin Model - 검증 결과
- 파일: `3_검증결과_비교/검증데이터_예측1~2.jpg`
- 내용: 실제 정답 vs 모델 예측 비교

### A5. Eyes Model - 모델 파일
- 파일: `YOLO_MODEL_FILES_백업용/eyes_yolov8m_best.pt`
- 크기: 50MB
- 클래스: 30개 안구질환

### A6. Health Model - 모델 파일
- 파일: `YOLO_MODEL_FILES_백업용/health_yolov8m_best.pt`
- 크기: 52MB
- 클래스: 3개 건강상태

---

## 🔗 참고 자료

### 기술 문서

1. **YOLOv8 공식 문서**: https://docs.ultralytics.com/
2. **논문**: Jocher, G. et al. (2023). Ultralytics YOLOv8
3. **PyTorch 공식 문서**: https://pytorch.org/docs/
4. **Ultralytics GitHub**: https://github.com/ultralytics/ultralytics

### 데이터셋 출처

1. **Skin Model**: [LYSS의 피부질환 데이터 수집 경로]
2. **Eyes Model**: [LYSS의 안구질환 데이터 수집 경로]
3. **Health Model**: AI Hub 반려견/반려묘 건강정보 데이터
   - 출처: https://aihub.or.kr/

### 프로젝트 파일

1. **모델 파일**: `YOLO_MODEL_FILES_백업용/`
   - `skin_yolov8m_best.pt` (52MB)
   - `eyes_yolov8m_best.pt` (50MB)
   - `health_yolov8m_best.pt` (52MB)

2. **설정 파일**:
   - `skin_data.yaml`, `eyes_data.yaml`, `health_data.yaml`
   - `skin_args.yaml`, `eyes_args.yaml`, `health_args.yaml`

3. **클래스 정보**:
   - `SKIN_class_info.txt` (6개 클래스)
   - `EYES_class_info.txt` (30개 클래스)

4. **학습 결과**:
   - `Skin_YOLO_RESULT.md`
   - `eyes_YOLO_RESULT.md`
   - `health_YOLO_RESULT.md`

---

## 🎓 학습 내용 및 교훈

### 프로젝트를 통해 배운 점

1. **대규모 데이터 처리 경험**
   - 총 557,800+개 이미지 처리
   - 데이터 전처리 및 증강 기법 습득
   - JSON-JPG 매칭 및 YOLO 형식 변환

2. **멀티모달 AI 시스템 설계**
   - 3개 독립 모델의 앙상블 구조
   - LLM-RAG 통합 아키텍처 설계
   - 엔드투엔드 AI 파이프라인 구축

3. **하이퍼파라미터 튜닝의 중요성**
   - Skin Model에서 `optimizer: auto` 설정 실패 경험
   - 성능 급락 문제 분석 및 해결 방안 도출
   - 학습 안정성의 중요성 인식

4. **GPU 최적화 및 리소스 관리**
   - 131.5시간 연속 GPU 학습 경험
   - 메모리 효율적 사용법 습득
   - AMP (자동 혼합 정밀도) 활용

### 실패 경험과 극복

1. **Skin Model - 3차 도전 끝에 성공**
   - 1차 실패: A7 무증상 데이터 혼입
   - 2차 실패: JSON-JPG 매칭 실패
   - 3차 성공: 완벽한 데이터셋 구축 → 232,253개 활용

2. **Eyes Model - 클래스 복잡도 극복**
   - 30개 클래스 학습의 어려움
   - 72시간 장시간 학습 완주
   - 주요 질환 50% 이상 정확도 달성

3. **Health Model - 최고 성능 달성**
   - 간결한 3개 클래스로 88.2% mAP50
   - 21.5시간 효율적 학습
   - 실무 적용 가능한 수준 달성

---

## 💼 실무 활용 방안

### 1. 동물병원 진단 보조 시스템

```
사용 시나리오:
1. 보호자가 앱으로 반려동물 사진 촬영
2. 3-Model 앙상블로 즉시 분석
3. 피부/눈/건강상태 종합 진단
4. LLM이 이해하기 쉬운 설명 생성
5. 수의사에게 AI 진단 결과 공유
```

### 2. 반려동물 건강관리 앱

```
기능:
- 일일 건강 체크 (셀카로 간편 진단)
- 질환 조기 발견 알림
- 건강 히스토리 기록
- 수의사 원격 상담 연계
```

### 3. 펫보험 청구 지원 시스템

```
활용:
- 질환 증빙 자료 자동 생성
- 보험 청구서류 간소화
- 질환 심각도 객관적 평가
- 보험사-보호자-병원 연계
```

---

## ⚖️ 법적 고지사항

⚠️ **중요 안내**

1. **진단 목적 제한**
   - 본 AI 시스템은 **참고용**이며, 실제 진단은 반드시 자격을 갖춘 수의사가 수행해야 합니다.
   - 수의사법 준수: 본 시스템은 진단이 아닌 "정보 제공" 목적입니다.

2. **책임의 한계**
   - AI 예측 결과의 정확성을 100% 보장하지 않습니다.
   - 치료 결정은 반드시 전문 수의사와 상담 후 진행하세요.

3. **개인정보 보호**
   - 업로드된 이미지는 진단 후 즉시 삭제됩니다.
   - 개인정보 처리방침 준수


---


## 🏆 YOLO 트레이닝 요약

**Fetpal - 멀티모달 반려동물 AI 진단 시스템**

✅ **3개 YOLOv8m 모델 완성**
- Skin: 232,253개 데이터, 6개 클래스 (⚠️ 미흡)
- Eyes: 217,547개 데이터, 30개 클래스 (⚠️ 미흡)
- Health: 108,000+개 데이터, 3개 클래스 (✅ 우수)

✅ **총 557,800+개 이미지 학습**
- 131.5시간 GPU 학습 완주
- 39개 클래스 통합 진단 가능

✅ **RAG + Multi-LLM 통합 ⭐⭐⭐**
- pgvector 기반 커뮤니티 경험담 검색
- GPT-4 / Gemini / Claude 선택 가능
- HuggingFace 384차원 임베딩
- 평균 0.5초 이내 응답 (200% 목표 달성!)

✅ **Next.js 14 통합**
- Hook Composition 패턴
- Supabase BaaS 연동
- FastAPI AI Server 통합

---

**📝 문서 정보**
- **작성일**: 2025-11-14
- **작성자**: LYSS with Claude
- **버전**: v2.0 (4차 스프린트 최종)
- **이전 문서**: [08_Supabase_BaaS_가이드.md](./08_Supabase_BaaS_가이드.md)
- **관련 문서**: [07_성능_평가_결과서.md](./07_성능_평가_결과서.md)


