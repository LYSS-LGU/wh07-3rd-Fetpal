<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fetpal 시스템 흐름도</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
      @media print {
        body {
          margin: 0;
          font-size: 12px;
        }
        .page-break {
          page-break-before: always;
        }
        .no-print {
          display: none;
        }
      }
      body {
        font-family: "Malgun Gothic", Arial, sans-serif;
        line-height: 1.6;
        margin: 20px;
        color: #333;
        font-size: 13px;
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 15px;
        border-bottom: 3px solid #a29bfe;
      }
      h1 {
        color: #2c3e50;
        font-size: 22px;
        margin-bottom: 10px;
      }
      h2 {
        color: #2d3436;
        border-left: 4px solid #a29bfe;
        padding-left: 15px;
        margin-top: 25px;
        font-size: 16px;
        background-color: #dfe6e9;
        padding: 10px 15px;
      }
      h3 {
        color: #2c3e50;
        margin-top: 20px;
        font-size: 14px;
      }
      .flow-description {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        margin: 15px 0;
        font-style: italic;
      }
      .mermaid-placeholder {
        background-color: #e8f4f8;
        border: 2px dashed #3498db;
        border-radius: 8px;
        padding: 30px;
        margin: 20px 0;
        text-align: center;
        color: #2c3e50;
      }
      .step-box {
        background-color: #fff9db;
        border: 1px solid #fdcb6e;
        border-radius: 5px;
        padding: 12px;
        margin: 8px 0;
      }
      .user-action {
        background-color: #d1f2eb;
        border-left: 4px solid #00b894;
        padding: 10px;
        margin: 8px 0;
      }
      .system-action {
        background-color: #e8f4fd;
        border-left: 4px solid #74b9ff;
        padding: 10px;
        margin: 8px 0;
      }
      .data-flow {
        background-color: #fff5f5;
        border-left: 4px solid #ff7675;
        padding: 10px;
        margin: 8px 0;
      }
      .footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 15px;
        border-top: 1px solid #dee2e6;
        color: #7f8c8d;
        font-size: 11px;
      }
      .flow-legend {
        background-color: #f1f3f4;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        margin: 15px 0;
      }
      .flow-legend h4 {
        margin-top: 0;
        color: #495057;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>🐾 Fetpal 시스템 흐름도</h1>
      <p><strong>LGU+ why not camp 7기 3차 프로젝트</strong></p>
    </div>

    <div class="flow-description">
      <strong>📋 시스템 흐름도 개요</strong><br />
      주요 사용자 시나리오에 따른 데이터 및 제어 흐름을 나타냅니다. 각
      프로세스는 사용자 액션, 시스템 처리, 데이터 흐름으로 구분되어 있습니다.
    </div>

    <div class="flow-legend">
      <h4>📖 범례 (Legend)</h4>
      <div class="user-action">
        🟢 <strong>사용자 액션</strong>: 사용자가 직접 수행하는 작업
      </div>
      <div class="system-action">
        🔵 <strong>시스템 처리</strong>: 프론트엔드/백엔드에서 자동 처리되는
        작업
      </div>
      <div class="data-flow">
        🔴 <strong>데이터 흐름</strong>: 시스템 간 데이터 전송 및 저장
      </div>
    </div>

    <h2>1. 사용자 온보딩 (회원가입 및 반려동물 등록)</h2>

    <!-- prettier-ignore-start -->
    <!-- beautify ignore:start -->
    <pre class="mermaid">
%% [파일명: user_onboarding_flow.mermaid]
%% 머메이드 문법은 줄바꿈과 들여쓰기가 자유로우나, 명확하게 구분하는 것이 좋습니다.

graph TD
    %% 사용자 서브 그래프
    subgraph "사용자"
        A1(시작: 서비스 접속)
        A2(회원가입/로그인 선택)
        A3(이메일/소셜 정보 입력)
        A4(온보딩: 프로필 정보 입력)
        A5(반려동물 정보 입력)
        A6(등록 완료)
    end

    %% 시스템 서브 그래프
    subgraph "시스템 (프론트엔드 + Supabase)"
        B1(메인 페이지 표시)
        B2(Supabase Auth UI 제공)
        B3{소셜/이메일 인증}
        B4(profiles 테이블에 사용자 정보 저장)
        B5(palProfiles 테이블에 반려동물 정보 저장)
        B6(대시보드 페이지로 리디렉션)
    end

    %% 흐름 정의
    A1 --> B1
    B1 --> A2
    A2 --> B2
    B2 -- "사용자 정보" --> A3
    A3 -- "인증 요청" --> B3
    B3 -- "성공" --> B4
    B4 -- "프로필 입력 요청" --> A4
    A4 -- "프로필 정보 제출" --> B4
    B4 -- "반려동물 등록 유도" --> A5
    A5 -- "반려동물 정보 제출" --> B5
    B5 -- "성공" --> A6
    A6 --> B6
    </pre>
    <!-- beautify ignore:end -->
    <!-- prettier-ignore-end -->

    <h3>🔄 상세 프로세스</h3>

    <div class="step-box">
      <strong>Step 1: 서비스 접속</strong>
      <div class="user-action">👤 사용자: 웹사이트 접속</div>
      <div class="system-action">🖥️ 시스템: 메인 페이지 표시</div>
    </div>

    <div class="step-box">
      <strong>Step 2: 인증 과정</strong>
      <div class="user-action">👤 사용자: 회원가입/로그인 선택</div>
      <div class="system-action">🖥️ 시스템: Supabase Auth UI 제공</div>
      <div class="user-action">👤 사용자: 이메일/소셜 정보 입력</div>
      <div class="data-flow">📡 데이터: 인증 요청 → Supabase Auth</div>
    </div>

    <div class="step-box">
      <strong>Step 3: 프로필 설정</strong>
      <div class="system-action">
        🖥️ 시스템: 인증 성공 → profiles 테이블에 기본 정보 저장
      </div>
      <div class="user-action">
        👤 사용자: 프로필 정보 입력 (이름, 주소, 연락처 등)
      </div>
      <div class="data-flow">
        📡 데이터: 프로필 정보 → profiles 테이블 업데이트
      </div>
    </div>

    <div class="step-box">
      <strong>Step 4: 반려동물 등록</strong>
      <div class="user-action">
        👤 사용자: 반려동물 정보 입력 (이름, 종, 생년월일 등)
      </div>
      <div class="data-flow">
        📡 데이터: 반려동물 정보 → palProfiles 테이블 저장
      </div>
      <div class="system-action">
        🖥️ 시스템: 등록 완료 → 대시보드로 리디렉션
      </div>
    </div>

    <div class="page-break"></div>

    <h2>2. AI 건강진단 (핵심 기능)</h2>

    <!-- prettier-ignore-start -->
    <!-- beautify ignore:start -->
    <pre class="mermaid">
graph TD
    subgraph "사용자"
        C1(건강진단 메뉴 선택)
        C2(사진 업로드)
        C3(결과 확인)
        C4(상세 정보/대처 방안 확인)
    end

    subgraph "프론트엔드"
        D1(업로드 UI 표시)
        D2(이미지 파일 Supabase Storage에 업로드)
        D3(이미지 URL을 AI 서버로 전송)
        D4(AI 서버로부터 분석 결과 수신)
        D5(결과 시각화: 이미지 + 텍스트)
    end

    subgraph "백엔드"
        E1[Supabase Storage]
        E2[Python AI 서버]
        E3[YOLO/OpenCV 모델]
        E4[RAG/LLM 모듈]
    end

    C1 --> D1
    D1 --> C2
    C2 -- "이미지 파일" --> D2
    D2 -- "이미지 저장" --> E1
    E1 -- "이미지 URL 반환" --> D2
    D2 --> D3
    D3 -- "분석 요청" --> E2
    E2 -- "모델 호출" --> E3
    E3 -- "1차 분석 결과" --> E2
    E2 -- "LLM 연동" --> E4
    E4 -- "최종 텍스트 생성" --> E2
    E2 -- "JSON 결과 반환" --> D4
    D4 --> D5
    D5 --> C3
    C3 --> C4
    </pre>
    <!-- beautify ignore:end -->
    <!-- prettier-ignore-end -->

    <h3>🔄 상세 프로세스</h3>

    <div class="step-box">
      <strong>Step 1: 진단 시작</strong>
      <div class="user-action">👤 사용자: 건강진단 메뉴 선택</div>
      <div class="system-action">🖥️ 프론트엔드: 업로드 UI 표시</div>
    </div>

    <div class="step-box">
      <strong>Step 2: 이미지 업로드</strong>
      <div class="user-action">👤 사용자: 반려동물 사진 업로드</div>
      <div class="data-flow">
        📡 데이터: 이미지 파일 → Supabase Storage 저장
      </div>
      <div class="system-action">🖥️ Storage: 이미지 URL 반환</div>
    </div>

    <div class="step-box">
      <strong>Step 3: AI 분석 요청</strong>
      <div class="system-action">
        🖥️ 프론트엔드: 이미지 URL을 AI 서버로 전송
      </div>
      <div class="data-flow">
        📡 데이터: 분석 요청 (POST /analyze) → Python AI 서버
      </div>
    </div>

    <div class="step-box">
      <strong>Step 4: AI 모델 처리</strong>
      <div class="system-action">🤖 AI 서버: YOLO & OpenCV 모델 호출</div>
      <div class="system-action">
        🤖 AI 모델: 이미지 내 객체(병변) 탐지 및 분석
      </div>
      <div class="data-flow">
        📡 데이터: 1차 분석 결과 (바운딩 박스, 신뢰도)
      </div>
    </div>

    <div class="step-box">
      <strong>Step 5: LLM 연동</strong>
      <div class="system-action">🤖 AI 서버: RAG/LLM 모듈 호출</div>
      <div class="data-flow">
        📡 데이터: LLM Provider API 호출 (OpenAI/Gemini)
      </div>
      <div class="system-action">
        🤖 LLM: 최종 텍스트 생성 (대처 방안, 추천사항)
      </div>
    </div>

    <div class="step-box">
      <strong>Step 6: 결과 표시</strong>
      <div class="data-flow">📡 데이터: JSON 결과 반환 → 프론트엔드</div>
      <div class="system-action">
        🖥️ 프론트엔드: 결과 시각화 (이미지 + 바운딩 박스 + 텍스트)
      </div>
      <div class="user-action">👤 사용자: 결과 확인 및 상세 정보 열람</div>
    </div>

    <div class="page-break"></div>

    <h2>3. 커뮤니티 게시글 작성 및 정보 얻기</h2>

    <!-- prettier-ignore-start -->
    <!-- beautify ignore:start -->
    <pre class="mermaid">
graph TD
    subgraph "사용자 (작성자)"
        F1(커뮤니티 진입)
        F2(글쓰기 버튼 클릭)
        F3(제목, 내용, #해시태그, 이미지 입력)
        F4(작성 완료)
    end

    subgraph "사용자 (독자)"
        G1(커뮤니티 진입)
        G2(#해시태그 클릭)
        G3(연관 게시글 및 YouTube 영상 확인)
    end

    subgraph "시스템"
        H1[프론트엔드]
        H2[Supabase DB]
        H3[YouTube API]
    end

    F1 --> H1
    F2 --> H1
    F3 -- "게시글 데이터" --> H1
    H1 -- "데이터 저장 요청" --> H2
    H2 -- "저장 완료" --> H1
    H1 --> F4

    G1 --> H1
    H1 -- "게시글 목록 로드" --> H2
    H2 -- "목록 반환" --> H1
    H1 --> G2
    G2 -- "태그 정보 전달" --> H1
    H1 -- "1. 태그 기반 게시글 검색" --> H2
    H1 -- "2. 태그 기반 영상 검색" --> H3
    H2 -- "검색 결과 반환" --> H1
    H3 -- "영상 목록 반환" --> H1
    H1 -- "결과 통합 표시" --> G3
    </pre>
    <!-- beautify ignore:end -->
    <!-- prettier-ignore-end -->

    <h3>🔄 게시글 작성 프로세스</h3>

    <div class="step-box">
      <strong>게시글 작성 흐름</strong>
      <div class="user-action">👤 사용자: 커뮤니티 진입 → 글쓰기 버튼 클릭</div>
      <div class="user-action">
        👤 사용자: 제목, 내용, #해시태그, 이미지 입력
      </div>
      <div class="data-flow">
        📡 데이터: 게시글 데이터 → Supabase DB (communityPosts 테이블)
      </div>
      <div class="system-action">🖥️ 시스템: 저장 완료 → 작성 완료 페이지</div>
    </div>

    <h3>🔄 정보 검색 프로세스</h3>

    <div class="step-box">
      <strong>Step 1: 커뮤니티 탐색</strong>
      <div class="user-action">👤 사용자: 커뮤니티 진입</div>
      <div class="system-action">🖥️ 프론트엔드: 게시글 목록 로드 요청</div>
      <div class="data-flow">📡 데이터: Supabase DB → 게시글 목록 반환</div>
    </div>

    <div class="step-box">
      <strong>Step 2: 해시태그 기반 검색</strong>
      <div class="user-action">
        👤 사용자: #해시태그 클릭 (예: #결막염, #피부병)
      </div>
      <div class="system-action">🖥️ 프론트엔드: 태그 정보를 시스템에 전달</div>
    </div>

    <div class="step-box">
      <strong>Step 3: 통합 검색 실행</strong>
      <div class="data-flow">
        📡 데이터: 태그 기반 게시글 검색 → Supabase DB
      </div>
      <div class="data-flow">
        📡 데이터: 태그 기반 영상 검색 → YouTube Data API
      </div>
      <div class="system-action">🖥️ 시스템: 검색 결과 통합 및 정렬</div>
    </div>

    <div class="step-box">
      <strong>Step 4: 결과 표시</strong>
      <div class="system-action">
        🖥️ 프론트엔드: 연관 게시글 + YouTube 영상 통합 표시
      </div>
      <div class="user-action">👤 사용자: 관련 정보 확인 및 영상 시청</div>
    </div>

    <div class="page-break"></div>

    <h2>4. 주변 병원/매장 찾기 (지도 API 연동)</h2>

    <!-- prettier-ignore-start -->
    <!-- beautify ignore:start -->
    <pre class="mermaid">
graph TD
    subgraph "사용자"
        I1(주변 시설 찾기 메뉴 선택)
        I2{현재 위치 제공 동의}
        I3(지도에서 병원/매장 정보 확인)
        I4(특정 장소 선택)
        I5(상세 정보 확인: 평점, 거리, 길찾기)
    end

    subgraph "시스템"
        J1[프론트엔드]
        J2[브라우저 Geolocation API]
        J3[Kakao Map API]
    end

    I1 --> J1
    J1 -- "위치 정보 요청" --> I2
    I2 -- "동의" --> J1
    J1 -- "위치 좌표 요청" --> J2
    J2 -- "좌표 반환" --> J1
    J1 -- "(좌표 + '동물병원') 검색 요청" --> J3
    J3 -- "주변 병원 목록 반환" --> J1
    J1 -- "지도에 마커 표시" --> I3
    I3 --> I4
    I4 -- "상세 정보 요청" --> J1
    J1 -- "장소 ID로 상세 정보 요청" --> J3
    J3 -- "상세 정보 반환" --> J1
    J1 -- "상세 정보 팝업 표시" --> I5
    </pre>
    <!-- beautify ignore:end -->
    <!-- prettier-ignore-end -->

    <h3>🔄 상세 프로세스</h3>

    <div class="step-box">
      <strong>Step 1: 서비스 시작</strong>
      <div class="user-action">👤 사용자: 주변 시설 찾기 메뉴 선택</div>
      <div class="system-action">🖥️ 프론트엔드: 위치 정보 요청 팝업 표시</div>
    </div>

    <div class="step-box">
      <strong>Step 2: 위치 정보 획득</strong>
      <div class="user-action">👤 사용자: 현재 위치 제공 동의</div>
      <div class="data-flow">
        📡 데이터: 브라우저 Geolocation API → 위치 좌표 획득
      </div>
      <div class="system-action">🖥️ 시스템: 좌표 정보 저장</div>
    </div>

    <div class="step-box">
      <strong>Step 3: 주변 시설 검색</strong>
      <div class="data-flow">
        📡 데이터: (좌표 + '동물병원') 검색 요청 → Kakao Map API
      </div>
      <div class="system-action">
        🗺️ Kakao API: 주변 병원/약국/펫샵 목록 반환
      </div>
      <div class="system-action">🖥️ 프론트엔드: 지도에 마커 표시</div>
    </div>

    <div class="step-box">
      <strong>Step 4: 시설 정보 확인</strong>
      <div class="user-action">👤 사용자: 지도에서 병원/매장 정보 확인</div>
      <div class="user-action">👤 사용자: 특정 장소 선택</div>
    </div>

    <div class="step-box">
      <strong>Step 5: 상세 정보 제공</strong>
      <div class="data-flow">
        📡 데이터: 장소 ID로 상세 정보 요청 → Kakao Map API
      </div>
      <div class="system-action">
        🗺️ Kakao API: 상세 정보 반환 (평점, 거리, 영업시간, 연락처)
      </div>
      <div class="system-action">🖥️ 프론트엔드: 상세 정보 팝업 표시</div>
      <div class="user-action">👤 사용자: 평점, 거리, 길찾기 등 정보 활용</div>
    </div>

    <div class="flow-description">
      <strong>💡 추가 기능</strong><br />
      • <strong>실시간 정보</strong>: 영업시간, 진료 가능 여부 실시간 확인<br />
      • <strong>리뷰 시스템</strong>: 다른 보호자들의 병원 이용 후기<br />
      • <strong>길찾기 연동</strong>: 네이버맵/카카오맵 길찾기 바로 연결<br />
      • <strong>즐겨찾기</strong>: 자주 이용하는 병원/매장 저장 기능
    </div>

    <div class="footer">
      <p>
        <strong>LGU+ why not camp 7기 3차 프로젝트 Fetpal 프로토타입</strong>
      </p>
      <p>Generated on: 2025년 9월 30일</p>
    </div>

    <script>
      mermaid.initialize({
        startOnLoad: true,
        theme: "default",
        flowchart: {
          useMaxWidth: true,
          htmlLabels: true,
        },
      });
    </script>
  </body>
</html>
